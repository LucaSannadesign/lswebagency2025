---
import Layout from '@/layouts/PageLayout.astro';
import Hero from '@/components/widgets/Hero.astro';
import BlogLatestPosts from '@/components/widgets/BlogLatestPosts.astro';
import CallToAction from '@/components/widgets/CallToAction.astro';
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';

const metadata = {
  title: 'Realizzazione Siti Web Sassari | LS Web Agency & SEO',
  description:
    'LS Web Agency realizza siti web, e-commerce, SEO e marketing digitale su misura per aziende e professionisti a Sassari.',
  ignoreTitleTemplate: true,
};

/* ---------- Portfolio (ordinamento robusto per data) ---------- */
const LIMIT = 8;

// timestamp sicuro: 0 se manca/è invalido → va in fondo
const ts = (v: unknown) => {
  const d =
    v instanceof Date
      ? v
      : typeof v === 'string' && v
        ? new Date(v)
        : null;
  return d && !Number.isNaN(d.getTime()) ? d.getTime() : 0;
};

const portfolioAll = await getCollection('portfolio');

const portfolioLatest = portfolioAll
  .filter((e) => !((e.data as any)?.draft === true))
  .slice()
  .sort((a, b) => {
    const tb = ts(b.data.publishDate ?? b.data.updateDate);
    const ta = ts(a.data.publishDate ?? a.data.updateDate);
    // più recenti prima; tie-breaker sullo slug
    return tb - ta || String(b.data.slug || '').localeCompare(String(a.data.slug || ''));
  })
  .slice(0, LIMIT);
---

<Layout metadata={metadata}>
  <!-- Hero Section -->
<!-- HERO con gradient che sfuma a bianco + immagine più grande -->
<section class="relative isolate">
  <!-- sfumatura top ► bottom che termina in bianco -->
  <div
    aria-hidden="true"
    class="pointer-events-none absolute inset-x-0 top-0 -z-10
           h-[520px] sm:h-[560px] md:h-[600px]
           bg-gradient-to-b from-violet-100/80 via-white to-transparent
           dark:from-violet-900/30 dark:via-transparent">
  </div>

  <Hero
    actions={[
      { variant: 'primary', text: 'Richiedi una consulenza', href: '/contatti' },
      { text: 'I nostri servizi', href: '#servizi' },
    ]}
    image={{
      /* Consigliato: metti il file in /public/images/ e usa il path assoluto */
      src: '/images/realizzazione-siti-web-sassari-sardegna.webp',
      alt: 'Realizzazione siti web a Sassari',
      /* dimensioni reali per evitare CLS e migliorare LCP */
      width: 1600,
      height: 1066,
      /* allarga visivamente il blocco immagine a destra */
      containerClass: 'md:max-w-[820px] lg:max-w-[980px] xl:max-w-[1100px] 2xl:max-w-[1200px]',
      class: 'rounded-3xl shadow-xl ring-1 ring-black/5',
      /* opzionale: spostala leggermente verso l’esterno sui desktop
         class: 'md:translate-x-2 lg:translate-x-4 rounded-3xl shadow-xl ring-1 ring-black/5' */
      loading: 'eager',
      fetchpriority: 'high',
      decoding: 'async',
    }}
  >
    <span slot="title">
      Realizzazione siti web a Sassari&nbsp;
      <span class="text-accent text-gradient dark:text-white highlight">
        ottimizzati per SEO
      </span>
    </span>

    <span slot="subtitle">
      <span class="hidden sm:inline">
        LS Web Agency progetta <strong>siti web</strong>, <strong>e-commerce</strong> e
        strategie di <strong>SEO</strong> e <strong>marketing digitale</strong> su misura per
        aziende e professionisti a Sassari.
      </span>
      <span class="block mb-1 sm:hidden font-bold text-blue-600">
        Affidati a noi per la tua presenza online!
      </span>
    </span>
  </Hero>
</section>

  <!-- I Nostri Servizi -->
  <section id="servizi" class="container mx-auto px-4 py-12">
    <h2 class="text-3xl font-bold text-center mb-8">I Nostri Servizi</h2>
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:device-laptop" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">Creazione Siti Web</h3>
        <p class="text-gray-600 mb-4">Siti responsive, veloci e SEO-friendly.</p>
        <a href="/servizi/creazione-siti-web-sassari" class="btn-primary">Scopri</a>
      </div>

      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:shopping-cart" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">E-commerce</h3>
        <p class="text-gray-600 mb-4">Piattaforme di vendita online performanti.</p>
        <a href="/servizi/realizzazione-siti-ecommerce" class="btn-primary">Scopri</a>
      </div>

      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:chart-bar" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">SEO & Posizionamento</h3>
        <p class="text-gray-600 mb-4">Strategie per scalare Google.</p>
        <a href="/servizi/ottimizzazione-seo-siti-web" class="btn-primary">Scopri</a>
      </div>

      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:palette" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">Branding & Grafica</h3>
        <p class="text-gray-600 mb-4">Identità visiva e loghi professionali.</p>
        <a href="/servizi/branding-e-grafica-siti-web" class="btn-primary">Scopri</a>
      </div>

      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:database-export" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">WordPress Slim</h3>
        <p class="text-gray-600 mb-4">Trasforma WordPress in un sito statico o headless.</p>
        <a href="/servizi/wordpress-slim-siti-statici-headless" class="btn-primary">Scopri</a>
      </div>

      <div class="flex flex-col items-center text-center p-6 border rounded-lg shadow-sm">
        <Icon name="tabler:robot" class="w-12 h-12 text-blue-600 mb-4" />
        <h3 class="text-xl font-semibold mb-2">AI Blog Engine</h3>
        <p class="text-gray-600 mb-4">Articoli SEO creati con AI e rifiniti da esperti.</p>
        <a href="/servizi/ai-blog-engine" class="btn-primary">Scopri</a>
      </div>
    </div>

    <div class="text-center mt-10">
      <a href="/servizi" class="btn-secondary">Scopri tutti i servizi</a>
    </div>
  </section>

  <!-- Ultimi Lavori -->
  <section id="ultimi-lavori" class="container mx-auto px-4 py-12">
    <div class="mb-6 flex items-end justify-between">
      <h2 class="text-3xl font-bold">Ultimi lavori</h2>
      <a href="/portfolio" class="text-sm underline">Vedi tutti</a>
    </div>

    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
      {portfolioLatest.map((item) => {
        const hrefRaw = item.data.permalink ?? `/portfolio/${item.data.slug}`;
        const href = hrefRaw.replace(/\/+$/, '');
        const img = item.data.image as
          | { src: string; alt?: string; width?: number; height?: number }
          | undefined;

        return (
          <article class="rounded-xl overflow-hidden border hover:shadow-md transition-shadow">
            <a href={href} aria-label={`Apri: ${item.data.title}`} class="block">
              {img?.src && (
                <img
                  src={img.src}
                  alt={img.alt ?? item.data.title}
                  width={img.width ?? 1200}
                  height={img.height ?? 800}
                  loading="lazy"
                  decoding="async"
                  class="w-full object-cover aspect-[3/2] rounded-lg"
                />
              )}
              <div class="p-4">
                <h3 class="text-base font-semibold mb-1 line-clamp-2">{item.data.title}</h3>
                {item.data.description && (
                  <p class="text-sm text-gray-700 line-clamp-3">{item.data.description}</p>
                )}
              </div>
            </a>
          </article>
        );
      })}
    </div>
  </section>

  <!-- CTA centrale -->
  <section class="my-16">
    <div class="mx-auto max-w-5xl rounded-3xl bg-gray-50 ring-1 ring-gray-200 px-6 py-14 text-center md:px-12">
      <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight text-gray-900">
        Vuoi un sito web che porti davvero risultati?
      </h2>
      <p class="mt-4 text-lg text-gray-600">
        Dalla strategia al design, ti aiutiamo a creare un sito veloce, sicuro e ottimizzato per Google.
      </p>

      <div class="mt-8 flex items-center justify-center gap-4">
        <a
          href="/contatti"
          class="inline-flex items-center justify-center rounded-full px-8 py-3 text-base font-semibold text-white bg-blue-600 hover:bg-blue-700 shadow-lg transition focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
        >
          Prenota una consulenza
        </a>
        <a
          href="/servizi"
          class="inline-flex items-center justify-center rounded-full px-8 py-3 text-base font-semibold text-white bg-pink-600 hover:bg-pink-700 shadow-lg transition focus:outline-none focus-visible:ring-2 focus-visible:ring-pink-500"
        >
          Scopri i servizi
        </a>
      </div>

      <p class="mt-6 text-sm text-gray-500">
        Preventivo trasparente · Supporto continuo · Soluzioni su misura
      </p>
    </div>
  </section>

  <!-- Blog -->
<BlogLatestPosts>
  <span slot="title">Dal nostro blog:</span>
  <span slot="information">Approfondimenti su SEO, web design e marketing digitale.</span>
</BlogLatestPosts>

  <!-- FAQ -->
  <section id="faq" class="mt-24 px-6 lg:px-8 max-w-4xl mx-auto">
    <h2 class="text-3xl font-bold mb-8">Domande Frequenti</h2>
    <div class="space-y-8 border-t border-gray-200 pt-8">
      <div class="border-b pb-6">
        <h3 class="text-xl font-semibold dark:text-white">Quanto costa un sito web professionale?</h3>
        <p class="mt-2 dark:text-slate-300">Soluzioni a partire da <strong>490€</strong>.</p>
      </div>
      <div class="border-b pb-6">
        <h3 class="text-xl font-semibold dark:text-white">In quanto tempo viene realizzato?</h3>
        <p class="mt-2 dark:text-slate-300">Da 1–2 settimane per siti base, fino a 4 per progetti più grandi.</p>
      </div>
      <div class="border-b pb-6">
        <h3 class="text-xl font-semibold dark:text-white">Il sito sarà ottimizzato per Google?</h3>
        <p class="mt-2 dark:text-slate-300">Sì: ottimizzazione SEO inclusa fin da subito.</p>
      </div>
      <div>
        <h3 class="text-xl font-semibold dark:text-white">Posso gestire il sito autonomamente?</h3>
        <p class="mt-2 dark:text-slate-300">Certo! Pannello facile da usare e formazione inclusa.</p>
      </div>
    </div>
  </section>

  <!-- Call to Action -->
  <CallToAction
    actions={[{
      variant: 'primary',
      text: 'Prenota una consulenza gratuita',
      href: '/contatti',
      icon: 'tabler:message'
    }]}
  >
    <span slot="title">Pronto a far crescere il tuo business online?</span>
    <span slot="subtitle">
      Contattaci oggi stesso e scopri come possiamo aiutarti con soluzioni web su misura.
    </span>
  </CallToAction>
</Layout>