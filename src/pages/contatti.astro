---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import Features2 from '~/components/widgets/Features2.astro';

const metadata = {
  title: 'Contatti - LS Web Agency',
  description: 'Hai bisogno di informazioni? Contattaci per una consulenza gratuita.',
  canonical: '/contatti',
  openGraph: {
    type: 'website',
    url: 'https://lswebagency.com/contatti',
    title: 'Contatti - LS Web Agency',
    description: 'Contattaci per discutere il tuo progetto.',
  },
  twitter: {
    card: 'summary_large_image',
    site: '@lswebagency',
    title: 'Contatti - LS Web Agency',
    description: 'Richiedi una consulenza gratuita.',
  }
};
---

<Layout metadata={metadata}>
  <HeroText tagline="Contatti" title="Hai bisogno di informazioni?" />

  <section class="text-center max-w-3xl mx-auto mb-8">
    <p class="text-xl font-medium">
      Hai un progetto in mente? <span class="text-blue-500">Contattaci oggi stesso</span> e trasformiamo le tue idee in realtà!
    </p>
  </section>

  <div class="max-w-lg mx-auto bg-white dark:bg-gray-900 p-6 rounded-lg shadow-xl">
    <form id="contactForm" class="space-y-4" action="/api/contatti" method="POST">
      <input type="hidden" name="timestamp" id="formTimestamp" />

      <div style="display: none;">
        <label for="honeypot">Lascia questo campo vuoto</label>
        <input type="text" name="honeypot" id="honeypot" />
      </div>

      <div>
        <label for="name" class="block text-sm font-medium">Nome e Cognome *</label>
        <input type="text" id="name" name="user_name" required class="input-field" />
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="email" class="block text-sm font-medium">Email *</label>
          <input type="email" id="email" name="user_email" required class="input-field" />
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium">Telefono</label>
          <input type="tel" id="phone" name="user_phone" class="input-field" />
        </div>
      </div>

      <div>
        <label for="service" class="block text-sm font-medium">Servizio di interesse *</label>
        <select id="service" name="user_service" required class="input-field">
          <option value="" disabled selected hidden>Seleziona un’opzione</option>
          <option value="siti-web">Creazione Sito Web</option>
          <option value="ecommerce">E-commerce</option>
          <option value="seo">SEO</option>
          <option value="grafica">Branding e Grafica</option>
          <option value="altro">Altro</option>
        </select>
      </div>

      <div>
        <label for="message" class="block text-sm font-medium">Messaggio *</label>
        <textarea id="message" name="user_message" rows="5" required class="input-field"></textarea>
      </div>

      <div class="flex items-start">
        <input type="checkbox" id="privacy" name="privacy" required class="checkbox" />
        <label for="privacy" class="ml-2 text-sm">* Accetto la raccolta e l’elaborazione dei dati.</label>
      </div>

      <button type="submit" class="btn-submit">Invia Richiesta</button>
    </form>

    <script type="module">
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("contactForm");
        const timestampInput = document.getElementById("formTimestamp");
        if (timestampInput) timestampInput.value = Date.now();

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const honeypot = document.getElementById("honeypot")?.value;
          if (honeypot) {
            console.warn("❌ Spam rilevato (honeypot)");
            return;
          }

          const formData = new FormData(form);
          try {
            const response = await fetch(form.action, {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              window.location.href = "/grazie";
            } else {
              const err = await response.json();
              alert("Errore: " + (err?.error || "Invio fallito"));
            }
          } catch (error) {
            console.error("Errore di rete:", error);
            alert("Errore di rete. Riprova.");
          }
        });
      });
    </script>
  </div>

  <Features2
    title="Siamo qui per aiutarti!"
    columns={4}
    items={[
      {
        title: 'Contatti Rapidi',
        description: `
        <div class="flex gap-4 mt-2">
          <a href="https://wa.me/393403223494" class="btn-whatsapp">WhatsApp</a>
          <a href="https://t.me/lswebagency" class="btn-telegram">Telegram</a>
        </div>`,
        icon: 'tabler:message',
      },
      {
        title: 'Telefono',
        description: '<a href="tel:+393403223494" class="contact-link">+39 340 3223 494</a>',
        icon: 'tabler:headset',
      },
      {
        title: 'Email',
        description: '<a href="mailto:info@lswebagency.com" class="contact-link">info@lswebagency.com</a>',
        icon: 'tabler:mail',
      },
      {
        title: 'Indirizzo',
        description: 'Via Alcide De Gasperi, 3, 07100 Sassari',
        icon: 'tabler:map-pin',
      },
    ]}
  />
</Layout>