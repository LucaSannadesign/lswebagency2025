---
import Document from '@/layouts/Layout.astro';
import Header from '@/components/widgets/Header.astro';
import Footer from '@/components/widgets/Footer.astro';
import CookieBanner from '@/components/CookieBanner.astro'; // ✅ ADD
import type { MetaData } from '@/types';

export interface Props { metadata?: MetaData }
const metadata = (Astro.props.metadata ?? {}) as MetaData;
---

<Document metadata={metadata}>
  <Header />

  <main id="main" class="min-h-screen">
    <slot />
  </main>

  <Footer />

  <!-- ✅ Cookie banner / preferenze -->
  <CookieBanner />

  <!-- Scroll to top -->
  <button
    id="scrollToTop"
    type="button"
    aria-label="Torna su"
    class="fixed bottom-6 right-6 z-[80] 
           h-12 w-12 rounded-full
           bg-slate-900/90 text-white
           shadow-lg ring-1 ring-white/10
           backdrop-blur
           opacity-0 translate-y-2 pointer-events-none
           transition-all duration-300 ease-in-out
           hover:bg-slate-900
           focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2
           dark:bg-slate-100/90 dark:text-slate-900 dark:ring-slate-900/10 dark:hover:bg-slate-100
           md:bottom-8 md:right-8"
  >
    <span aria-hidden="true" class="text-xl leading-none">↑</span>
  </button>

  <script is:inline>
    (() => {
      const btn = document.getElementById('scrollToTop');
      if (!btn) return;

      const SHOW_AT = 300;
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const onScroll = () => {
        const y = window.scrollY || document.documentElement.scrollTop || 0;
        if (y > SHOW_AT) {
          btn.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
          btn.classList.add('opacity-100', 'translate-y-0');
        } else {
          btn.classList.add('opacity-0', 'translate-y-2', 'pointer-events-none');
          btn.classList.remove('opacity-100', 'translate-y-0');
        }
      };

      btn.addEventListener('click', () => {
        try {
          window.scrollTo({ 
            top: 0, 
            behavior: prefersReducedMotion ? 'auto' : 'smooth' 
          });
        } catch {
          window.scrollTo(0, 0);
        }
      });

      // Keyboard navigation support
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });

      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    })();
  </script>
</Document>